<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admin â€” Precious Time</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#98a3a3;
      --card:#b3c6c3;
      --accent:#97c7c7;
      --dark:#0f172a;
      --muted:#415376;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--dark);padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    header h1{font-size:20px;color:var(--dark);margin:0}
    header .small{color:var(--muted);font-size:13px}

    .wrap{display:grid;grid-template-columns:400px 1fr;gap:22px;align-items:start}
    @media(max-width:900px){.wrap{grid-template-columns:1fr}}

    .panel{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(15,23,42,0.06)}
    form .row{margin-bottom:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"],input[type="number"],select,input[type="file"],textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #159476;font-size:14px}
    textarea{resize:none;height:60px}
    button.primary{background:linear-gradient(135deg,var(--accent),var(--dark));color:white;border:0;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(14,165,164,0.12)}
    button.primary:active{transform:translateY(1px)}

    .section{margin-bottom:32px}
    .section h3{margin-bottom:12px}

    .list-grid{display:flex;flex-wrap:wrap;gap:14px}
    .product-card{width:220px;background:var(--card);border-radius:12px;padding:12px;box-shadow:0 8px 20px rgba(15,23,42,0.06);text-align:left}
    .product-card img{width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:8px}
    .product-card h4{margin:0;font-size:15px}
    .product-meta{font-size:13px;color:var(--muted);margin:6px 0}
    .product-price{color:#b12704;font-weight:700;margin-bottom:8px}
    .actions{display:flex;gap:8px}
    .btn{padding:8px 10px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .btn.edit{background:#0ea5a4;color:#fff}
    .btn.delete{background:var(--danger);color:#fff}

    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.5);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal{width:100%;max-width:640px;background:var(--card);border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(2,6,23,0.4)}
    .modal h3{margin:0 0 8px}
    .modal .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .modal .actions{margin-top:14px;text-align:right}
    .small-muted{font-size:13px;color:var(--muted)}
    .row-flex{display:flex;gap:8px}
    .center{display:flex;align-items:center;gap:8px}
    .empty{padding:40px;text-align:center;color:var(--muted)}

    /* Orders CSS */
    
  .order-card{width:300px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 8px 20px rgba(15,23,42,0.06);margin-bottom:16px}
#ordersContainer {
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 18px !important;
}

.order-card {
  width: 300px !important;
}
    .order-meta{font-size:13px;color:var(--muted);margin-bottom:6px}
    .order-date,.delivery-date{font-size:12px;color:var(--accent);margin-bottom:6px}
  </style>
</head>
<body>

<header>
  <div>
    <h1>Precious Time â€” Admin</h1>
    <div class="small">Add / Edit / Delete products & view orders</div>
  </div>
  <div class="small-muted">Backend: http://localhost:8081</div>
</header>

<div class="wrap">
  <div class="panel" id="addPanel">
    <h3 style="margin:0 0 12px">Add Product</h3>
    <form id="addForm" enctype="multipart/form-data">
      <div class="row"><label>Name</label><input id="name" name="name" type="text" required /></div>
      <div class="row row-flex">
        <div style="flex:1"><label>Brand</label><input id="brand" name="brand" type="text" required /></div>
        <div style="flex:1"><label>Model</label><input id="model" name="model" type="text" required /></div>
      </div>
      <div class="row"><label>Category</label>
        <select id="category" name="category" required>
          <option value="">Select category</option>
          <option value="men">Men</option>
          <option value="women">Women</option>
          <option value="men,women">Men & Women</option>
          <option value="home">Home</option>
        </select>
      </div>
      <div class="row row-flex">
        <div style="flex:1"><label>Price (â‚¹)</label><input id="price" name="price" type="number" step="0.01" required /></div>
        <div style="flex:1"><label>Stock</label><input id="stock" name="stock" type="number" required /></div>
      </div>
      <div class="row row-flex">
        <div style="flex:1"><label>Color</label><input id="color" name="color" type="text" required /></div>
        <div style="flex:1"><label>Image</label><input id="image" name="image" type="file" accept="image/*" required /></div>
      </div>
      <div class="row"><label>Description</label><textarea id="description" name="description" required></textarea></div>
      <div style="text-align:right;margin-top:8px"><button class="primary" type="submit">Add Product</button></div>
    </form>
  </div>

  <div>
    <!-- Products -->
    <div class="section"><h3>Men's Products</h3><div class="list-grid" id="menList"></div><div class="empty" id="menEmpty" style="display:none">No products in Men category.</div></div>
    <div class="section"><h3>Women's Products</h3><div class="list-grid" id="womenList"></div><div class="empty" id="womenEmpty" style="display:none">No products in Women category.</div></div>
    <div class="section"><h3>Home Products</h3><div class="list-grid" id="homeList"></div><div class="empty" id="homeEmpty" style="display:none">No products in Home category.</div></div>

    <!-- Orders -->
    <div class="section"><h3>Customer Orders</h3>
      <div id="ordersContainer" class="list-grid"></div>
      <div class="empty" id="ordersEmpty" style="display:none">No orders placed yet.</div>
    </div>
  </div>
</div>

<!-- Modal for Edit Product -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
  <div class="modal" role="document">
    <h3>Edit Product</h3>
    <div class="grid">
      <div><label>Name</label><input id="edit_name" type="text" /></div>
      <div><label>Brand</label><input id="edit_brand" type="text" /></div>
      <div><label>Model</label><input id="edit_model" type="text" /></div>
      <div><label>Category</label><input id="edit_category" type="text" /></div>
      <div><label>Price</label><input id="edit_price" type="number" step="0.01" /></div>
      <div><label>Stock</label><input id="edit_stock" type="number" /></div>
      <div><label>Color</label><input id="edit_color" type="text" /></div>
      <div style="grid-column:1/-1"><label>Description</label><textarea id="edit_description"></textarea></div>
    </div>
    <div class="actions">
      <button id="modalCancel" class="btn" style="background:#efefef;border-radius:8px">Cancel</button>
      <button id="modalSave" class="btn edit">Save changes</button>
    </div>
  </div>
</div>

<script>
(() => {
  const API = "http://localhost:8081/admin";
  const addForm = document.getElementById('addForm');
  const menList = document.getElementById('menList');
  const womenList = document.getElementById('womenList');
  const homeList = document.getElementById('homeList');
  const menEmpty = document.getElementById('menEmpty');
  const womenEmpty = document.getElementById('womenEmpty');
  const homeEmpty = document.getElementById('homeEmpty');

  const modalBackdrop = document.getElementById('modalBackdrop');
  const modalSave = document.getElementById('modalSave');
  const modalCancel = document.getElementById('modalCancel');

  const editName = document.getElementById('edit_name');
  const editBrand = document.getElementById('edit_brand');
  const editModel = document.getElementById('edit_model');
  const editCategory = document.getElementById('edit_category');
  const editPrice = document.getElementById('edit_price');
  const editStock = document.getElementById('edit_stock');
  const editColor = document.getElementById('edit_color');
  const editDescription = document.getElementById('edit_description');

  let editingId = null;
  function imageUrl(path){return path?API.replace('/admin','')+path:'';}

  async function fetchProducts(){
    try{
      const res = await fetch(`${API}/products`);
      if(!res.ok) throw new Error('Failed to fetch');
      const products = await res.json();
      menList.innerHTML = womenList.innerHTML = homeList.innerHTML = '';
      let menCount=0,womenCount=0,homeCount=0;

      products.forEach(p=>{
        const card = document.createElement('div'); card.className='product-card';
        const img=document.createElement('img'); img.src=imageUrl(p.imagePath); img.alt=p.name;
        const h4=document.createElement('h4'); h4.innerText=p.name;
        const meta=document.createElement('div'); meta.className='product-meta'; meta.innerText=`${p.brand} â€¢ ${p.model}`;
        const price=document.createElement('div'); price.className='product-price'; price.innerText=`â‚¹${p.price}`;
        const desc=document.createElement('div'); desc.className='small-muted'; desc.innerText=p.description;
        const actions=document.createElement('div'); actions.className='actions';
        const editBtn=document.createElement('button'); editBtn.className='btn edit'; editBtn.innerText='âœ Update'; editBtn.addEventListener('click',()=>openEditModal(p));
        const delBtn=document.createElement('button'); delBtn.className='btn delete'; delBtn.innerText='ðŸ—‘ Delete'; delBtn.addEventListener('click',()=>confirmDelete(p.id,p.name));
        actions.appendChild(editBtn); actions.appendChild(delBtn);
        card.appendChild(img); card.appendChild(h4); card.appendChild(meta); card.appendChild(price); card.appendChild(desc); card.appendChild(actions);
        const categories=(p.category||'').toLowerCase().split(',').map(c=>c.trim());
        if(categories.includes('men')){menList.appendChild(card);menCount++;}
        if(categories.includes('women')){womenList.appendChild(card);womenCount++;}
        if(categories.includes('home')){homeList.appendChild(card);homeCount++;}
      });

      menEmpty.style.display=menCount===0?'block':'none';
      womenEmpty.style.display=womenCount===0?'block':'none';
      homeEmpty.style.display=homeCount===0?'block':'none';
    } catch(err){console.error(err); menList.innerHTML=womenList.innerHTML=homeList.innerHTML='<div class="empty">Error loading products.</div>'}
  }

  addForm.addEventListener('submit',async e=>{
    e.preventDefault();
    const form=new FormData(addForm);
    try{
      const res=await fetch(`${API}/addProduct`,{method:'POST',body:form});
      const text=await res.text();
      if(text==='success'){alert('âœ… Product added');addForm.reset();fetchProducts();}
      else{alert('âŒ Add failed: '+text);}
    }catch(err){console.error(err);alert('âŒ Add failed (network)');}
  });

  function confirmDelete(id,name){if(confirm(`Delete "${name}"?`)){deleteProduct(id);}}
  async function deleteProduct(id){
    try{
      const res=await fetch(`${API}/delete/${id}`,{method:'DELETE'});
      const text=await res.text();
      if(text==='deleted'){alert('ðŸ—‘ Product deleted');fetchProducts();} else{alert('âŒ Product not found');}
    }catch(err){console.error(err);alert('âŒ Delete failed (network)');}
  }

  function openEditModal(p){
    editingId=p.id;
    editName.value=p.name; editBrand.value=p.brand; editModel.value=p.model;
    editCategory.value=p.category; editPrice.value=p.price; editStock.value=p.stock;
    editColor.value=p.color; editDescription.value=p.description;
    modalBackdrop.style.display='flex';
  }

  function closeModal(){editingId=null; modalBackdrop.style.display='none';}
  modalCancel.addEventListener('click',closeModal);
  modalBackdrop.addEventListener('click',e=>{if(e.target===modalBackdrop) closeModal();});
  modalSave.addEventListener('click',async()=>{
    if(!editingId){alert('No product selected'); return;}
    const form=new FormData();
    form.append('name',editName.value); form.append('brand',editBrand.value); form.append('model',editModel.value);
    form.append('category',editCategory.value); form.append('price',editPrice.value); form.append('stock',editStock.value);
    form.append('color',editColor.value); form.append('description',editDescription.value);
    try{
      const res=await fetch(`${API}/update/${editingId}`,{method:'POST',body:form});
      const text=await res.text();
      if(text==='updated'){alert('âœ… Product updated'); closeModal(); fetchProducts();}
      else{alert('âŒ Update failed: '+text);}
    }catch(err){console.error(err);alert('âŒ Update failed (network)');}
  });

  fetchProducts();
})();

// Orders JS
(async()=>{
  const ordersContainer=document.getElementById('ordersContainer');
  const ordersEmpty=document.getElementById('ordersEmpty');

  async function fetchOrders(){
    try{
      const res=await fetch('http://localhost:8081/orders');
      if(!res.ok) throw new Error('Failed to fetch orders');
      const orders=await res.json();

      ordersContainer.innerHTML='';
      if(orders.length===0){ordersEmpty.style.display='block'; return;}
      else{ordersEmpty.style.display='none';}

      orders.forEach(o=>{
        const card=document.createElement('div'); card.className='order-card';
        const h4=document.createElement('h4'); h4.innerText=`Order #${o.id} - ${o.name}`;
        const meta=document.createElement('div'); meta.className='order-meta';
        meta.innerHTML=`<strong>Email:</strong> ${o.email} <br>
                        <strong>Phone:</strong> ${o.phone} <br>
                        <strong>Pincode:</strong> ${o.pincode} <br>
                        <strong>Address:</strong> ${o.address}`;
        const orderDate=new Date(o.createdAt||Date.now());
        const orderDateDiv=document.createElement('div'); orderDateDiv.className='order-date';
        orderDateDiv.innerText=`Order Date: ${orderDate.toLocaleDateString()} ${orderDate.toLocaleTimeString()}`;
        const deliveryDate=new Date(orderDate); deliveryDate.setDate(orderDate.getDate()+1);
        const deliveryDateDiv=document.createElement('div'); deliveryDateDiv.className='delivery-date';
        deliveryDateDiv.innerText=`Estimated Delivery: ${deliveryDate.toLocaleDateString()}`;
        card.appendChild(h4); card.appendChild(meta); card.appendChild(orderDateDiv); card.appendChild(deliveryDateDiv);
        ordersContainer.appendChild(card);
      });
    }catch(err){console.error(err); ordersContainer.innerHTML='<div class="empty">Failed to load orders.</div>';}
  }

  fetchOrders();
})();
</script>
<style>/* ðŸ”¥ Premium Orders Section (Admin Dashboard Style) */
.order-card{
  width:100%;
  background:var(--card);
  border-radius:14px;
  padding:18px 20px;
  box-shadow:0 10px 28px rgba(0,0,0,0.06);
  margin-bottom:18px;
  border:1px solid #e9ecef;
  transition:all 0.25s ease;
}

.order-card:hover{
  transform:translateY(-2px);
  box-shadow:0 14px 36px rgba(0,0,0,0.10);
}

.order-card h4{
  margin:0 0 6px;
  font-size:17px;
  color:#111827;  /* dark elegant */
  font-weight:600;
}

.order-meta{
  font-size:14px;
  line-height:1.6;
  color:#4b5563;   /* muted gray */
  margin-bottom:8px;
}

.order-meta strong{
  color:#111; /* darker bold labels */
}

.order-date,
.delivery-date{
  font-size:13px;
  margin-top:4px;
  padding:6px 10px;
  border-radius:8px;
  display:inline-block;
  font-weight:500;
}

.order-date{
  background:#e0f7f6;               /* mint background */
  color:#0f766e;                     /* teal text */
}

.delivery-date{
  background:#fff4e6;               /* soft peach */
  color:#b45309;                    /* warm brown */
}

/* No Orders Text */
#ordersEmpty{
  color:#6b7280;
  font-size:15px;
}
</style>
</body>
</html>
